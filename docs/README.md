# ⚾︎ 미션 - 숫자 야구


## 👀 문제 확인하기
- 우아한테크코스 2주차 과제 중 '**숫자 야구**'의 구현 기능과 구현 로직을 담은 문서입니다.
- 문제는 [여기](https://github.com/woowacourse-precourse/java-baseball)에서 확인해 주세요.

---

## 🌟 구현 기능 목록

### ✔ 게임 제어 기능 (메인)
- 첫 실행 시 게임 시작 메시지를 출력하도록 제어 후, 게임을 시작한다.
    - 사용자로부터 값을 입력받아 게임을 진행한다.
- 게임 진행 시 컴퓨터의 수와 사용자의 수를 비교하여 볼, 스트라이크 수를 카운트 후 출력한다.
- 스트라이크 수가 3인지 체크한다. 
- 첫 게임 종료 후 사용자의 입력값에 따라 게임 실행을 제어한다.
    - 사용자가 1번을 입력했을 경우 게임을 재시작한다.
    - 사용자가 2번을 입력했을 경우 게임을 종료한다.

### ✔ 사용자로부터 값을 입력받는 기능
- 사용자로부터 값을 입력받는다.

### ✔ 컴퓨터의 랜덤 숫자 생성 기능
- 컴퓨터가 게임에서 사용할 수를 생성한다.
    - 1~9 사이의 서로 다른 숫자를 가진 3글자의 랜덤한 수를 생성하여 리스트에 담는다.

### ✔ 입력값 검증 기능 ️
- 사용자가 입력한 수에 대해 검증을 진행한다. 다음의 경우 `IllegalArgumentException`을 발생시킨다.
    - 게임 진행 시 숫자를 입력할 때
        - 입력한 수의 길이가 3이 아닌 경우
        - 입력한 수에 1~9 사이의 숫자가 아닌 다른 문자가 들어있는 경우
        - 입력한 수에 중복된 숫자가 들어있는 경우
    - 게임 종료 후 재시작/종료 값을 입력할 때
        - 1 혹은 2 아닌 다른 값이 들어오는 경우

### ✔ 컴퓨터 / 사용자 수 비교 기능
- 컴퓨터와 사용자의 수를 비교하여 볼, 스트라이크의 수를 리턴한다.
    - 사용자가 입력한 수에 컴퓨터가 생성한 수가 존재하지만, 다른 위치에 있다면 볼 카운트를 증가시킨다.
    - 사용자가 입력한 수에 컴퓨터가 생성한 수가 존재하면서, 동일한 위치에 있다면 스트라이크 카운트를 증가시킨다.

### ✔ 스트라이크 수 체크 기능
- 스트라이크의 수가 3개라면 성공 메시지를 출력하도록 제어한다.
  - 이후, 사용자에게 수를 입력받는다.
  - 만약 사용자가 1이나 2가 아닌 다른 수를 입력하는지 검증한다.
  - 사용자가 1을 입력하면 컴퓨터가 새로운 숫자를 만들도록 제어한다.

### ✔ 메시지 출력 기능
- 게임 진행 시 출력되는 메시지를 관리한다.
    - 첫 게임 시작 시 `숫자 야구 게임을 시작합니다`를 출력한다.
    - 게임 진행 시 `숫자를 입력해주세요 : `를 출력한다.
    - 사용자가 숫자를 입력한 이후, 볼 / 스트라이크 개수에 따른 결과 메시지를 출력한다.
        - `x볼`, `y스트라이크`, `x볼 y스트라이크` 순으로 출력한다.
        - 만약 둘 다 0개라면 `낫싱`을 출력한다.
    - 사용자가 숫자를 모두 맞혔을 경우 2개의 메시지를 출력한다.
        - `3개의 숫자를 모두 맞히셨습니다! 게임 종료`를 출력한다.
        - `게임을 새로 시작하려면 1, 종료하려면 2를 입력하세요.`를 출력한다.
    - 예외가 발생했을 경우 예외에 따른 메시지를 출력한다.
        - 입력한 수의 길이가 3이 아니라면 `3글자를 입력해 주세요.`를 출력한다.
        - 입력한 수에 0이 들어있다면 `1~9 사이의 값을 입력해 주세요.`를 출력한다.
        - 중복된 숫자가 들어있다면 `중복된 숫자는 입력할 수 없습니다.`를 출력한다.
        - 게임 종료 후 1, 2가 아닌 다른 문자가 들어왔다면 `1(재시작) 혹은 2(종료)를 입력해 주세요.`를 출력한다.

---

## 💡 구현 로직
~~~
1. 게임 시작 시 '숫자 야구 게임을 시작합니다.'를 출력한다.

2. 게임이 시작되면 컴퓨터는 3글자의 수를 만들어낸다.

3. '숫자를 입력해주세요: ' 메시지 출력 후, 사용자에게 숫자를 입력받는다.
    3-1. 사용자의 입력값이 길이가 3글자인지 검증한다.
    3-2. 사용자의 입력값의 각 자리수가 1~9 사이의 숫자인지 검증한다.
    3-3. 사용자의 입력값의 각 자리수에 중복된 값이 들어있는지 검증한다.
    
4. 사용자와 컴퓨터의 수를 비교해서 볼, 스트라이크 개수를 계산한다.
    4-1. 계산 후 사용자에게 결과값을 출력한다.

5. 만약 스트라이크 수가 3개라면 '3개의 숫자를 모두 맞히셨습니다! 게임 종료'를 출력한다.
    5-1. '게임을 새로 시작하려면 1, 종료하려면 2를 입력하세요.'를 출력 후 사용자에게 값을 입력받는다.
    5-2. 사용자가 1 혹은 2를 입력했는지 검증한다.
    5-3. 만약 1을 입력했다면 2~5번의 과정을 반복한다.
    5-4. 만약 2를 입력했다면 그대로 게임을 종료한다.
~~~

---

## 🔍 소감
- 두 번째 우아한 테크코스 과제인 만큼 처음보다 더 고민한 점이 많았던 과제였습니다.  

### **😊 패키지 분리하기**  
- 패키지를 어떤 식으로 분리하면 좋을지 고민이 많았던 시간이었습니다. 
  - 지난 주차 과제의 경우 명시적으로 7문제가 주어졌기 때문에 패키지 분리를 단순히 문제 단위로 진행할 수 있었으나,
이번 주차 과제는 하나의 큰 문제에 대해서 풀어나가야 하기 때문에 어떻게 하면 분리를 효율적으로 할 수 있을지 고민했습니다.
  - 그래서, 크게 상수 관리를 위한 패키지와 유틸 패키지로 나누었습니다. '숫자 야구 게임'이라는 특성에 맞게 이번 주차에서는
관리해야 하는 상수와 메시지가 많았기 때문에 별도의 패키지에서 숫자에 대한 상수와 메시지에 대한 상수 클래스로 나누어 관리하였습니다.
  - 또한, 유틸 패키지의 경우 컴퓨터와 사용자, 그리고 메시지로 나누어 컴퓨터가 사용하는 클래스와 사용자가 사용하는 클래스.
그리고 메시지 출력을 위한 클래스로 나누었습니다. 다만, 컴퓨터와 사용자가 사용할 수 있는 메서드가 각각 1가지밖에 없어서 
둘을 하나의 인풋에 대한 패키지로 나누어 관리하는 게 더 나았을 것 같다는 생각도 약간 들었습니다.

### **🤭 매력적인 Stream**  
- Stream은 평소에도 자주 사용하기 때문에 큰 거부감이 없었으나, 늘 한정된 용도로만 사용해왔습니다.
  - 가령 map을 통한 인자 변환이나 forEach를 통한 반복 등, 응용을 별로 해본 적이 없었기 때문에 기능에 대한 큰 감흥이 없었습니다.
- 그러나, 이번 주차 과제를 진행하면서 '입력값에 대한 중복된 값 검증 기능'에서 그 기능을 크게 체험하였습니다.
  - 기존에는 중복값 검증 시 컴퓨터 수를 생성하는 방법과 마찬가지로 리스트에 값이 포함되어 있지 않으면 넣고, 
마지막으로 해당 리스트의 사이즈가 3이 아니면 중복된 값이 있다고 판단하였습니다. 그러나, 이러한 로직은 코드 길이가 길어져서 로직 이해에 쉽지 않겠다는 생각이 들었습니다.
  - 그러다가 stream().distinct().count()를 발견하고, 확실하게 준 코드 길이에 놀랐습니다. 이렇게 되면 사이즈에 대한 검증이 들어가지 않고, 
직관적으로 함수 네이밍에서 distinct() 덕분에 '중복되지 않은 것의 개수가 3개'라는 것을 확실하게 표현할 수 있었습니다.
- 또한, '입력값이 1~9 사이의 숫자인지 검증하는 절차'에서도 Stream을 사용하였습니다.
  - 기존에는 1~9 사이의 숫자인지, 그리고 문자가 들어있는지 정규식을 통해 검증하고자 하였습니다. 코드 자체는 문자와 숫자를 한 번에 검증할 수 있어 좋았지만,
for-each를 통해 리스트의 각 요소를 순회하며 정규식을 적용하면서 코드가 길어지는 부분이 마음에 들지 않았습니다.
  - 이를 해결하기 위해 stream().allMatch()를 활용하여 각 요소가 주어진 범위 안에 있는지 한 번에 체크하였습니다. 정규식을 사용하였을 때보다 <= 를 통한 값 비교 덕분에
로직 이해가 더 쉽게 느껴졌으며, 코드 길이도 짧아져 나름의 클린 코드를 가져갔던 것 같아 뿌듯했습니다.
    

### **🧐테스트 코드가 뭔가요?**
- 이번 주차에서 가장 애를 먹고 노력을 많이 했던 부분입니다. 
  - 지난 주차와 다르게, '테스트 코드 작성'이라는 새로운 미션이 나왔습니다. 
기존에 테스트 코드 작성을 많이 해본 적이 없어 가장 걱정하고, 또 어려워했던 부분이었습니다.
- 초기에 1차적으로 코드를 구현한 다음, 첫 테스트 코드를 돌려보았을 때 어떠한 로직 상의 문제로 테스트 코드는 계속 실패하였습니다.
  - 당시 발생하였던 오류는 `execution timed out after 10000ms`에 관한 오류였습니다. 
처음에는 단순히 로직이 오래 걸리기 때문에 (10초 이상) 발생한 줄 알고 계속해서 코드를 수정해나가고자 하였습니다.
하지만, 여러 번의 수정을 거쳐도 계속해서 같은 오류가 발생하자 테스틐 코드에 대한 근본적인 이해가 필요하다고 느꼈습니다.
  - '왜 컴퓨터는 랜덤하게 값을 생성할 텐데, 항상 동일한 결과가 나올 수 있는 것인가?'에 대한 의문을 품고 본격적으로 코드를 까보기 시작했습니다.
- 그 결과, `assertRandomNumberInRangeTest` 메서드의 인자로 준 value, values가 무슨 의미인지 파악할 수 있었습니다.
  - mock.when.thenReturn 진행 시 연속적으로 해당 값을 사용하고 싶을 때 하나씩 꺼내어서 사용한다는 것이었습니다.
즉, 해당 메서드의 경우 2번의 게임을 진행하며 컴퓨터가 2번의 숫자를 생성하게 되고, 이는 곧 컴퓨터가 하나의 값을 생성할 때 
각각 3번씩 Randoms.pickNumberInRange()를 사용하기 때문에, 
value부터 values에 있는 값까지 총 6번을 하나씩 꺼내어서 사용하게 됩니다.
  - 그렇기 때문에 컴퓨터는 3번 / 3번씩 나누어 (3글자를 만들어내니까) '135', '589'라는 고정된 값을 만들 수 있는 것이었고,
run을 통해 사용자의 커맨드에 들어온 행위에 따라 항상 같은 결과를 도출해낼 수 있던 거였습니다.
- 이를 깨닫고 나서 왜 컴퓨터가 값을 생성할 때 미션에서 주어진 Randoms 라이브러리를 사용해야 했는지,
어떤 의도로 테스트 코드를 설계한 것인지 이해할 수 있게 되자 테스트 코드에 굉장한 흥미를 느끼게 되었습니다.
  - 결과적으로 제 오류는 게임 종료 후 재시작 / 종료 값을 입력받을 때 '재시작'인 경우만 컴퓨터가 값을 생성하도록 했어야 했는데,
종료인 경우에도 값을 생성하게 하면서 이미 values에 담긴 값을 다 사용하여 가장 마지막 값인 '9'를 계속해서 리스트에 담게 되고,
동일한 값이 계속 들어오기 때문에 리스트의 크기가 증가하지 않아 무한 루프에 빠지게 되어 실행 시간을 초과했던 것이었습니다.
- 이렇게 큰 삽질을 진행하고 나니, 왜 테스트 코드가 필요한 것인지, 그리고 테스트 코드를 통해 제 로직을 검증할 수 있는 시간이 되면서
앞으로도 테스트 코드를 작성하는 습관을 꼭 가져야겠다고 깨달을 수 있었던 순간이었습니다. 개인적으로 이번 주차에서 가장 크게 배웠던 부분입니다.

  
